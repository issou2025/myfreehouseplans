{% extends 'base.html' %}

{% block extra_css %}
  <link rel="stylesheet" href="{{ url_for('static', filename='progress_intelligence/progress_intelligence.css') }}">
{% endblock %}

{% block content %}
<section class="pi-hero" style="padding-bottom: 0;">
  <div class="pi-shell">
    <div class="pi-eyebrow">
      <i class="fa-solid fa-flag-checkered" aria-hidden="true"></i>
      <span>Visual progression • Clear stopping point • Free PDF</span>
    </div>
    <h1 class="pi-title" style="font-size: clamp(28px, 3.5vw, 44px);">Your simulation result</h1>
    <p class="pi-lead">The most important output is the last phase realistically reachable. This is a prevention tool, not a quote.</p>
  </div>
</section>

<section class="pi-section">
  <div class="pi-shell">
    <div class="pi-panel">
      <div class="pi-summary">
        <div>
          <h2 class="pi-panel__title">Stopping point</h2>
          <p class="pi-lead" style="font-size: 20px; margin-top: 10px;"><strong>{{ result.stopping_phase }}</strong></p>
          <p class="pi-help" style="margin-top: 8px;">{{ result.explanation }}</p>
        </div>
        <div class="pi-summary__meta">
          <div class="pi-summary__row">
            <i class="fa-solid fa-building" aria-hidden="true"></i>
            <div>
              <strong>{{ result.inputs.building_type }}</strong>
              <div class="pi-help">Project type</div>
            </div>
          </div>
          <div class="pi-summary__row">
            <i class="fa-solid fa-ruler-combined" aria-hidden="true"></i>
            <div>
              <strong>{{ result.inputs.area_value|round(0) }} {{ result.inputs.area_unit }}</strong>
              <div class="pi-help">Surface</div>
            </div>
          </div>
          <div class="pi-summary__row">
            <i class="fa-solid fa-layer-group" aria-hidden="true"></i>
            <div>
              <strong>{{ result.inputs.floors }}</strong>
              <div class="pi-help">Floors</div>
            </div>
          </div>
          <div class="pi-summary__row">
            <i class="fa-solid fa-cubes" aria-hidden="true"></i>
            <div>
              <strong>{{ result.inputs.material }}</strong>
              <div class="pi-help">Material</div>
            </div>
          </div>
          <div class="pi-summary__row">
            <i class="fa-solid fa-wallet" aria-hidden="true"></i>
            <div>
              {% set has_total = result.inputs.total_budget is not none %}
              {% set has_monthly = result.inputs.monthly_contribution is not none %}
              {% if has_total and has_monthly %}
                <strong>Total + Monthly</strong>
              {% elif has_total %}
                <strong>Total only</strong>
              {% elif has_monthly %}
                <strong>Monthly only</strong>
              {% else %}
                <strong>No budget inputs</strong>
              {% endif %}
              <div class="pi-help">Budget mode</div>
            </div>
          </div>
          <div class="pi-summary__row">
            <i class="fa-solid fa-location-dot" aria-hidden="true"></i>
            <div>
              <strong>{{ result.inputs.country_name }}</strong>
              <div class="pi-help">Context</div>
            </div>
          </div>
        </div>
      </div>
      <div class="pi-badge-row">
        <span class="pi-badge"><i class="fa-solid fa-clock" aria-hidden="true"></i> Generated: {{ result.created_utc }}</span>
      </div>
    </div>

    <div class="pi-panel" style="margin-top: 14px;">
      <h2 class="pi-panel__title">Visual progress</h2>
      <p class="pi-help" style="margin-top: 8px;">Horizontal phase bars summarize reachability at a glance.</p>
      <div class="pi-progress" style="margin-top: 12px;">
        {% for st in result.statuses %}
          {% if st.status == 'green' %}
            {% set fill = 1.0 %}
            {% set tone = 'green' %}
            {% set label = 'Reached' %}
          {% elif st.status == 'orange' %}
            {% set fill = 0.6 %}
            {% set tone = 'orange' %}
            {% set label = 'Fragile / Partial' %}
          {% else %}
            {% set fill = 0.2 %}
            {% set tone = 'red' %}
            {% set label = 'Not reached' %}
          {% endif %}
          <div class="pi-progress__row">
            <div class="pi-progress__label">
              <strong>{{ st.phase }}</strong>
              <span>{{ label }}</span>
            </div>
            <div class="pi-progress__bar" role="presentation">
              <span class="pi-progress__fill pi-progress__fill--{{ tone }}" style="width: {{ (fill * 100) | round(0) }}%;"></span>
            </div>
          </div>
        {% endfor %}
      </div>
    </div>

    <div class="pi-panel" style="margin-top: 14px;">
      <h2 class="pi-panel__title">Detailed phase analysis</h2>
      <div class="pi-timeline" style="margin-top: 12px;">
        {% for st in result.statuses %}
          <div class="pi-phase">
            <div>
              <strong>{{ st.phase }}</strong>
              <div class="pi-help">{{ st.note }}</div>
            </div>
            {% if st.status == 'green' %}
              <span class="pi-chip pi-chip--green">REACHED</span>
            {% elif st.status == 'orange' %}
              <span class="pi-chip pi-chip--orange">FRAGILE</span>
            {% else %}
              <span class="pi-chip pi-chip--red">NOT REACHED</span>
            {% endif %}
          </div>
        {% endfor %}
      </div>
    </div>

    <div class="pi-panel" style="margin-top: 14px;">
      <h2 class="pi-panel__title">Rhythm indicator</h2>
      {% if result.rhythm == 'stable' %}
        <p class="pi-lead" style="font-size: 16px; margin-top: 10px;"><strong>Stable progression</strong></p>
        <p class="pi-help">Continuity looks healthy. Protect it — interruptions matter more than speed.</p>
      {% elif result.rhythm == 'fragile' %}
        <p class="pi-lead" style="font-size: 16px; margin-top: 10px;"><strong>Fragile progression</strong></p>
        <p class="pi-help">A few interruptions can move the stopping point earlier. If possible, improve rhythm or reduce scope.</p>
      {% else %}
        <p class="pi-lead" style="font-size: 16px; margin-top: 10px;"><strong>Blocked / high stall risk</strong></p>
        <p class="pi-help">Without steady continuity, projects often stall for long periods. The safest action is to simplify early.</p>
      {% endif %}

      {% if result.margin_flag %}
        <div class="pi-note" style="margin-top: 12px;">
          <strong>Maximum effort without margin:</strong> you marked monthly effort as maximum. That increases fragility under pressure.
        </div>
      {% endif %}
    </div>

    <div class="pi-panel" style="margin-top: 14px;">
      <h2 class="pi-panel__title">How the intelligence reasoned</h2>
      <p class="pi-help" style="margin-top: 8px;">This tool combines surface scale, floors, material, budget rhythm, and human margin to identify where projects usually stall.</p>
      <ul class="pi-list" style="margin-top: 12px;">
        <li><i class="fa-solid fa-circle-check" aria-hidden="true"></i> <span>Surface scale sets the baseline complexity for continuity.</span></li>
        <li><i class="fa-solid fa-circle-check" aria-hidden="true"></i> <span>Floors increase risk in later phases even if surface stays constant.</span></li>
        <li><i class="fa-solid fa-circle-check" aria-hidden="true"></i> <span>Material shifts where effort concentrates (early vs late).</span></li>
        <li><i class="fa-solid fa-circle-check" aria-hidden="true"></i> <span>Budget rhythm and monthly continuity decide whether work can keep moving.</span></li>
        {% if result.margin_flag %}
          <li><i class="fa-solid fa-circle-check" aria-hidden="true"></i> <span>Maximum-effort inputs indicate low margin for shocks and delays.</span></li>
        {% endif %}
      </ul>
    </div>

    <div class="pi-panel" style="margin-top: 14px;">
      <h2 class="pi-panel__title">Practical advice</h2>
      <ul class="pi-list" style="margin-top: 12px;">
        {% for item in result.advice %}
          <li><i class="fa-solid fa-circle-check" aria-hidden="true"></i> <span>{{ item }}</span></li>
        {% endfor %}
      </ul>
    </div>

    <div class="pi-panel" style="margin-top: 14px;">
      <h2 class="pi-panel__title">Improvement suggestions</h2>
      <ul class="pi-list" style="margin-top: 12px;">
        {% for s in result.scenarios %}
          <li><i class="fa-solid fa-wand-magic-sparkles" aria-hidden="true"></i> <span><strong>{{ s.title }}:</strong> {{ s.effect }}</span></li>
        {% endfor %}
      </ul>
      <p class="pi-help" style="margin-top: 10px;">These are advisory — small scope or rhythm changes can improve outcomes.</p>
    </div>

    <div class="pi-panel" style="margin-top: 14px;">
      <h2 class="pi-panel__title">FAQ</h2>
      <div class="pi-faq" style="margin-top: 12px;">
        <div class="pi-faq__item">
          <h3>Is this tool a cost estimator or a quotation?</h3>
          <p>No. It does not provide prices or bills of quantities. It shows how far a project usually goes under real conditions.</p>
        </div>
        <div class="pi-faq__item">
          <h3>Why does the tool say my project stops early?</h3>
          <p>Because worldwide data shows that similar projects often run out of resources at that stage.</p>
        </div>
        <div class="pi-faq__item">
          <h3>Does this work in my country?</h3>
          <p>Yes. The tool uses international construction realities, not local prices.</p>
        </div>
        <div class="pi-faq__item">
          <h3>Why are floors and materials important?</h3>
          <p>They multiply complexity, time, and risk, even if the surface stays the same.</p>
        </div>
        <div class="pi-faq__item">
          <h3>Why don’t you show exact costs?</h3>
          <p>Because early decisions require clarity, not false precision.</p>
        </div>
        <div class="pi-faq__item">
          <h3>Can this replace an architect or engineer?</h3>
          <p>No. It helps you decide before engaging professionals.</p>
        </div>
      </div>
    </div>

    <div class="pi-actions" style="margin-top: 14px;">
      <a class="btn btn-primary" href="{{ url_for('progress_intelligence.report_pdf', t=token, lang=lang) }}">
        <i class="fa-solid fa-file-pdf" aria-hidden="true"></i>
        Download PDF report
      </a>
      <a class="btn btn-secondary" href="{{ url_for('progress_intelligence.start', lang=lang) }}">
        Try another scenario
      </a>
    </div>

    <div class="pi-links">
      <a href="{{ url_for('progress_intelligence.how_it_works', lang=lang) }}">How it works</a>
      <a href="{{ url_for('progress_intelligence.limitations', lang=lang) }}">Limitations</a>
    </div>

    <div class="pi-note" role="note" style="margin-top: 14px;">
      <strong>Reminder:</strong> This tool does not replace professional studies. It helps you avoid the most common failure pattern: stopping near the end.
    </div>
  </div>
</section>
{% endblock %}
