{% extends "base.html" %}

{% block content %}
<section class="hero hero--immersive" aria-labelledby="hero-heading">
    <div class="hero__backdrop" aria-hidden="true"></div>
    <div class="shell hero__layout">
        <div class="hero__text reveal">
            <span class="hero__tag"><i class="fa-solid fa-wand-magic-sparkles" aria-hidden="true"></i> Luxury Architectural Portfolio</span>
            <h1 id="hero-heading">Premium house plans engineered for real-world builds.</h1>
            <p class="hero__lead">{{ site_description }} Trusted documentation, precise dimensions, and curated styles so you can move from inspiration to construction-ready faster.</p>
            <div class="hero__search" aria-label="Search the site">
                <label class="sr-only" for="globalSearchInput">Search the entire site</label>
                <div class="search-shell glass" role="search">
                    <div class="search-shell__icon" aria-hidden="true"><i class="fa-solid fa-magnifying-glass"></i></div>
                    <input
                        id="globalSearchInput"
                        class="search-shell__input"
                        type="search"
                        placeholder="Search rooms, planners, or guides…"
                        autocomplete="off"
                        aria-controls="globalSearchResults"
                        aria-expanded="false">
                </div>
                <p class="hero__search-hint">Find any planner, room check, guide, or plan in seconds.</p>
                <div id="globalSearchResults" class="search-results glass" aria-live="polite" hidden>
                    <div class="search-results__group" data-group="tools">
                        <h3>Tools</h3>
                        <div class="search-results__list"></div>
                    </div>
                    <div class="search-results__group" data-group="articles">
                        <h3>Articles</h3>
                        <div class="search-results__list"></div>
                    </div>
                    <div class="search-results__group" data-group="pages">
                        <h3>Pages</h3>
                        <div class="search-results__list"></div>
                    </div>
                    <div class="search-results__empty" hidden>
                        Start typing to find planners, guides, and plans.
                    </div>
                </div>
            </div>
            <div class="hero__cta">
                <a href="{{ url_for('main.packs') }}" class="btn btn-primary btn--glow"><i class="fa-solid fa-compass" aria-hidden="true"></i> Explore catalog</a>
                <a href="{{ url_for('main.contact') }}" class="btn btn-outline btn-ghost"><i class="fa-solid fa-comments" aria-hidden="true"></i> Talk to an architect</a>
            </div>
            <div class="hero__metrics" aria-label="Studio metrics">
                {% set total_showcase = (featured_plans|length if featured_plans else 0) + (recent_plans|length if recent_plans else 0) %}
                <div class="metric-pill">
                    <i class="fa-solid fa-layer-group" aria-hidden="true"></i>
                    <div>
                        <span>{{ stats.total_plans if stats else total_showcase }}+</span>
                        <p>Ready-to-build plans</p>
                    </div>
                </div>
                <div class="metric-pill">
                    <i class="fa-solid fa-stopwatch" aria-hidden="true"></i>
                    <div>
                        <span>48h</span>
                        <p>Average technical response</p>
                    </div>
                </div>
                <div class="metric-pill">
                    <i class="fa-solid fa-globe" aria-hidden="true"></i>
                    <div>
                        <span>15+</span>
                        <p>Architectural styles</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="hero__visual reveal" aria-label="Plan highlights">
            <div class="glass" style="padding: 1.25rem;">
                <div class="tw-flex tw-items-start tw-justify-between tw-gap-4">
                    <div>
                        <p class="tw-text-xs tw-uppercase tw-tracking-wider tw-text-slate-300">Smart Architectural Analyzer</p>
                        <h2 class="tw-mt-1 tw-text-lg tw-font-semibold tw-text-white">Validate your layout in 60 seconds</h2>
                        <p class="tw-mt-1 tw-text-sm tw-text-slate-300">Add 3+ rooms, get waste + efficiency scores, then export an A4 PDF.</p>
                    </div>
                    <a class="btn btn-outline btn-ghost" href="{{ url_for('floor_plan.landing') }}" style="white-space: nowrap;">
                        <i class="fa-solid fa-up-right-from-square" aria-hidden="true"></i> Full tool
                    </a>
                </div>

                <div class="tw-mt-4 tw-grid tw-grid-cols-1 tw-gap-3">
                    <div class="tw-grid tw-grid-cols-2 tw-gap-2">
                        <label class="tw-text-xs tw-text-slate-300" for="fp-unit">Units</label>
                        <label class="tw-text-xs tw-text-slate-300" for="fp-room-type">Room type</label>

                        <select id="fp-unit" class="tw-w-full tw-rounded-lg tw-bg-slate-900/70 tw-border tw-border-slate-700 tw-px-3 tw-py-2 tw-text-sm tw-text-white">
                            <option value="metric" selected>Metric (m, m²)</option>
                            <option value="imperial">Imperial (ft, ft²)</option>
                        </select>

                        <select id="fp-room-type" class="tw-w-full tw-rounded-lg tw-bg-slate-900/70 tw-border tw-border-slate-700 tw-px-3 tw-py-2 tw-text-sm tw-text-white">
                            <option value="" selected disabled>Select a room…</option>
                            {% for group in analyzer_room_options or [] %}
                                {% if group.options %}
                                <optgroup label="{{ group.category }}">
                                    {% for opt in group.options %}
                                    <option value="{{ opt.value }}">{{ opt.label }}</option>
                                    {% endfor %}
                                </optgroup>
                                {% endif %}
                            {% endfor %}
                        </select>
                    </div>

                    <div class="tw-flex tw-items-center tw-justify-between tw-gap-2 tw-flex-wrap">
                        <div class="tw-flex tw-items-center tw-gap-4" role="radiogroup" aria-label="Input method">
                            <label class="tw-inline-flex tw-items-center tw-gap-2 tw-text-sm tw-text-slate-200">
                                <input type="radio" name="fp-method" value="dimensions" checked>
                                <span>Dimensions</span>
                            </label>
                            <label class="tw-inline-flex tw-items-center tw-gap-2 tw-text-sm tw-text-slate-200">
                                <input type="radio" name="fp-method" value="surface">
                                <span>Surface</span>
                            </label>
                        </div>
                        <p id="fp-error" class="tw-hidden tw-text-sm tw-text-rose-300"></p>
                    </div>

                    <div id="fp-dims" class="tw-grid tw-grid-cols-2 tw-gap-2">
                        <div>
                            <label class="tw-text-xs tw-text-slate-300" for="fp-length">Length</label>
                            <input id="fp-length" type="number" step="0.01" min="0" class="tw-w-full tw-rounded-lg tw-bg-slate-900/70 tw-border tw-border-slate-700 tw-px-3 tw-py-2 tw-text-sm tw-text-white" placeholder="e.g. 4.2">
                        </div>
                        <div>
                            <label class="tw-text-xs tw-text-slate-300" for="fp-width">Width</label>
                            <input id="fp-width" type="number" step="0.01" min="0" class="tw-w-full tw-rounded-lg tw-bg-slate-900/70 tw-border tw-border-slate-700 tw-px-3 tw-py-2 tw-text-sm tw-text-white" placeholder="e.g. 3.5">
                        </div>
                    </div>

                    <div id="fp-surface" class="tw-hidden">
                        <label class="tw-text-xs tw-text-slate-300" for="fp-area">Surface area</label>
                        <input id="fp-area" type="number" step="0.01" min="0" class="tw-w-full tw-rounded-lg tw-bg-slate-900/70 tw-border tw-border-slate-700 tw-px-3 tw-py-2 tw-text-sm tw-text-white" placeholder="e.g. 14.0">
                    </div>

                    <div class="tw-flex tw-items-center tw-justify-between tw-gap-2 tw-flex-wrap">
                        <button id="fp-add" type="button" class="btn btn-primary btn--glow">
                            <i class="fa-solid fa-plus" aria-hidden="true"></i> Add room
                        </button>
                        <div class="tw-flex tw-items-center tw-gap-2 tw-flex-wrap">
                            <button id="fp-analyze" type="button" class="btn btn-outline" disabled>
                                <i class="fa-solid fa-chart-line" aria-hidden="true"></i> Analyze
                            </button>
                            <button id="fp-pdf" type="button" class="btn btn-outline" disabled>
                                <i class="fa-solid fa-file-pdf" aria-hidden="true"></i> A4 PDF
                            </button>
                        </div>
                    </div>

                    <div id="fp-rooms" class="tw-grid tw-grid-cols-1 tw-gap-2" aria-label="Added rooms"></div>

                    <div id="fp-dashboard" class="tw-mt-1 tw-rounded-xl tw-border tw-border-slate-700 tw-bg-slate-950/40 tw-p-3" aria-label="Live efficiency dashboard">
                        <div class="tw-grid tw-grid-cols-2 tw-gap-3">
                            <div>
                                <p class="tw-text-xs tw-text-slate-400">Overall score</p>
                                <p id="fp-score" class="tw-text-2xl tw-font-semibold tw-text-white">—</p>
                            </div>
                            <div>
                                <p class="tw-text-xs tw-text-slate-400">Waste</p>
                                <p id="fp-waste" class="tw-text-2xl tw-font-semibold tw-text-white">—</p>
                            </div>
                        </div>
                        <div class="tw-mt-3 tw-grid tw-grid-cols-3 tw-gap-2">
                            <div class="tw-rounded-lg tw-border tw-border-slate-800 tw-bg-slate-900/40 tw-p-2">
                                <p class="tw-text-[11px] tw-text-slate-400">Financial</p>
                                <p id="fp-fin" class="tw-text-sm tw-font-semibold tw-text-white">—</p>
                            </div>
                            <div class="tw-rounded-lg tw-border tw-border-slate-800 tw-bg-slate-900/40 tw-p-2">
                                <p class="tw-text-[11px] tw-text-slate-400">Comfort</p>
                                <p id="fp-comf" class="tw-text-sm tw-font-semibold tw-text-white">—</p>
                            </div>
                            <div class="tw-rounded-lg tw-border tw-border-slate-800 tw-bg-slate-900/40 tw-p-2">
                                <p class="tw-text-[11px] tw-text-slate-400">Circulation</p>
                                <p id="fp-circ" class="tw-text-sm tw-font-semibold tw-text-white">—</p>
                            </div>
                        </div>
                        <p id="fp-dashboard-hint" class="tw-mt-2 tw-text-xs tw-text-slate-400">Tip: Add 3+ rooms and click Analyze.</p>
                        <div class="tw-mt-3 tw-flex tw-justify-end">
                            <button id="fp-open" type="button" class="btn btn-outline" disabled>
                                <i class="fa-solid fa-gauge" aria-hidden="true"></i> Open dashboard
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="section section--trust" aria-labelledby="trust-heading">
    <div class="shell">
        <div class="section-heading reveal">
            <div>
                <p class="eyebrow"><i class="fa-solid fa-shield-halved" aria-hidden="true"></i> Trusted by builders & homeowners</p>
                <h2 id="trust-heading">Built for clients who demand precision.</h2>
                <p>Designed for contractors, architects, and homeowners who need clear documentation, reliable details, and consistent quality.</p>
            </div>
        </div>
        <div class="trust-grid" role="list">
            <div class="trust-card reveal" role="listitem">
                <i class="fa-solid fa-award" aria-hidden="true"></i>
                <div>
                    <h3>Pro-grade documentation</h3>
                    <p>Complete drawings and schedules aligned with modern standards.</p>
                </div>
            </div>
            <div class="trust-card reveal" role="listitem">
                <i class="fa-solid fa-ruler-combined" aria-hidden="true"></i>
                <div>
                    <h3>Precision dimensions</h3>
                    <p>Metric and imperial measurements for global build teams.</p>
                </div>
            </div>
            <div class="trust-card reveal" role="listitem">
                <i class="fa-solid fa-layer-group" aria-hidden="true"></i>
                <div>
                    <h3>Consistent quality</h3>
                    <p>Curated plans vetted for clarity, flow, and construction logic.</p>
                </div>
            </div>
            <div class="trust-card reveal" role="listitem">
                <i class="fa-solid fa-headset" aria-hidden="true"></i>
                <div>
                    <h3>Responsive support</h3>
                    <p>Guidance when you need it, from selection to execution.</p>
                </div>
            </div>
        </div>
    </div>
</section>

{% if featured_plans %}
<section class="section section--bento" aria-labelledby="featured-heading">
    <div class="shell">
        <div class="section-heading reveal">
            <div>
                <p class="eyebrow"><i class="fa-solid fa-sparkles" aria-hidden="true"></i> Signature collection</p>
                <h2 id="featured-heading">Architect-approved favorites</h2>
                <p>Handpicked plans with deep documentation, BIM-friendly packs, and on-call experts.</p>
            </div>
            <a class="text-link" href="{{ url_for('main.packs') }}"><i class="fa-solid fa-arrow-trend-up" aria-hidden="true"></i> View all plans</a>
        </div>
        <div class="bento-grid">
            {% for plan in featured_plans %}
            {% set card_image = plan.cover_image or plan.main_image %}
            <article class="plan-card plan-card--bento reveal {% if loop.index == 1 %}span-2{% elif loop.index == 2 %}span-tall{% else %}span-1{% endif %}" itemscope itemtype="https://schema.org/Product">
                <a class="plan-card__media" href="{{ url_for('main.pack_detail', slug=plan.slug) }}" itemprop="url">
                    {% if card_image %}
                        {{ picture_tag(card_image, alt=plan.title, preset=CARD_PRESET, variant='base', loading='lazy', decoding='async', itemprop='image') }}
                    {% else %}
                        <div class="plan-card__placeholder">Rendering in progress</div>
                    {% endif %}
                    <div class="plan-card__status glass"><i class="fa-solid fa-bolt" aria-hidden="true"></i> Featured</div>
                </a>
                <div class="plan-card__body">
                    <p class="plan-card__eyebrow">
                        <i class="fa-solid fa-bookmark" aria-hidden="true"></i>
                        {% if plan.categories %}
                            {% for c in plan.categories %}
                                <a href="{{ url_for('main.plans_by_category', slug=c.slug) }}">{{ c.name }}</a>{% if not loop.last %} · {% endif %}
                            {% endfor %}
                        {% else %}
                            Modern living
                        {% endif %}
                    </p>
                    <h3 itemprop="name"><a href="{{ url_for('main.pack_detail', slug=plan.slug) }}">{{ plan.title }}</a></h3>
                    <p class="plan-card__summary" itemprop="description">{{ plan.architectural_summary }}</p>
                    <ul class="plan-card__stats" aria-label="Key characteristics">
                        {% if plan.area_sqft %}<li><i class="fa-solid fa-maximize" aria-hidden="true"></i>{{ plan.area_sqft|round|int }} sq ft</li>{% endif %}
                        {% if plan.bedrooms_count %}<li><i class="fa-solid fa-bed" aria-hidden="true"></i>{{ plan.bedrooms_count }} beds</li>{% endif %}
                        {% if plan.bathrooms_count %}<li><i class="fa-solid fa-bath" aria-hidden="true"></i>{{ plan.bathrooms_count }} baths</li>{% endif %}
                        {% if plan.floors_count %}<li><i class="fa-solid fa-building" aria-hidden="true"></i>{{ plan.floors_count }} floors</li>{% endif %}
                    </ul>
                    {% set visible_tiers = filter_pack_tiers(plan.pricing_tiers, pack_visibility) %}
                    {% if visible_tiers %}
                    <div class="plan-card__tiers" aria-label="Pack pricing overview">
                        {% for tier in visible_tiers %}
                        <div class="plan-card__tier {% if not tier.available %}plan-card__tier--muted{% endif %}">
                            <span><i class="fa-solid fa-box" aria-hidden="true"></i> Pack 0{{ tier.pack }}</span>
                            <span>
                                {% if tier.price and tier.price > 0 %}
                                    ${{ tier.price|round(0)|int }}
                                {% elif tier.pack == 1 %}
                                    Free
                                {% else %}
                                    Soon
                                {% endif %}
                            </span>
                        </div>
                        {% endfor %}
                    </div>
                    {% endif %}
                    {% set visible_paid_price = visible_starting_price(plan.pricing_tiers, pack_visibility) %}
                    <div class="plan-card__footer" itemprop="offers" itemscope itemtype="https://schema.org/Offer">
                        <div class="plan-card__price">
                            <span class="plan-card__ref"><i class="fa-solid fa-hashtag" aria-hidden="true"></i> {{ plan.reference_code }}</span>
                            {% if visible_paid_price %}
                                <span class="price" itemprop="price">From ${{ visible_paid_price|round(0)|int }}</span>
                            {% else %}
                                <span class="price" itemprop="price">Free</span>
                            {% endif %}
                        </div>
                        <div class="plan-card__cta">
                            <a class="btn btn-outline" href="{{ url_for('main.pack_detail', slug=plan.slug) }}"><i class="fa-solid fa-up-right-from-square" aria-hidden="true"></i> View plan</a>
                            <a class="text-link" href="{{ url_for('main.contact') }}"><i class="fa-solid fa-sparkles" aria-hidden="true"></i> Request guidance</a>
                        </div>
                        <meta itemprop="priceCurrency" content="USD">
                    </div>
                </div>
            </article>
            {% endfor %}
        </div>
    </div>
</section>
{% endif %}

{% if recent_plans %}
<section class="section section--scroll" aria-labelledby="recent-heading">
    <div class="shell">
        <div class="section-heading reveal">
            <div>
                <p class="eyebrow"><i class="fa-solid fa-signal" aria-hidden="true"></i> Fresh releases</p>
                <h2 id="recent-heading">New layouts every week</h2>
                <p>Each release includes annotated PDFs, CAD-ready assets, and onboarding notes.</p>
            </div>
        </div>
        <div class="plan-row" role="list">
            {% for plan in recent_plans %}
            <article class="plan-card plan-card--inline reveal" role="listitem">
                <a class="plan-card__media" href="{{ url_for('main.pack_detail', slug=plan.slug) }}">
                    {% set card_image = plan.cover_image or plan.main_image %}
                    {% if card_image %}
                        {{ picture_tag(card_image, alt=plan.title, preset=CARD_PRESET, variant='base', loading='lazy', decoding='async') }}
                    {% else %}
                        <div class="plan-card__placeholder">Visual coming soon</div>
                    {% endif %}
                    {% if plan.is_on_sale %}<span class="badge badge--outline">On sale</span>{% endif %}
                </a>
                <div class="plan-card__body">
                    <p class="plan-card__eyebrow">
                        <i class="fa-solid fa-bookmark" aria-hidden="true"></i>
                        {% if plan.categories %}
                            {% for c in plan.categories %}
                                <a href="{{ url_for('main.plans_by_category', slug=c.slug) }}">{{ c.name }}</a>{% if not loop.last %} · {% endif %}
                            {% endfor %}
                        {% else %}
                            Residential
                        {% endif %}
                    </p>
                    <h3><a href="{{ url_for('main.pack_detail', slug=plan.slug) }}">{{ plan.title }}</a></h3>
                    <div class="plan-card__stats plan-card__stats--inline">
                        {% if plan.area_sqft %}<span><i class="fa-solid fa-maximize" aria-hidden="true"></i>{{ plan.area_sqft|round|int }} sq ft</span>{% endif %}
                        {% if plan.bedrooms_count %}<span><i class="fa-solid fa-bed" aria-hidden="true"></i>{{ plan.bedrooms_count }} beds</span>{% endif %}
                        {% if plan.bathrooms_count %}<span><i class="fa-solid fa-bath" aria-hidden="true"></i>{{ plan.bathrooms_count }} baths</span>{% endif %}
                    </div>
                    <div class="plan-card__footer">
                        <span class="plan-card__ref"><i class="fa-solid fa-hashtag" aria-hidden="true"></i> {{ plan.reference_code }}</span>
                        <a class="btn btn-soft" href="{{ url_for('main.pack_detail', slug=plan.slug) }}"><i class="fa-solid fa-up-right-from-square" aria-hidden="true"></i> View</a>
                    </div>
                </div>
            </article>
            {% endfor %}
        </div>
    </div>
</section>
{% endif %}

<section class="section section--experience" aria-labelledby="experience-heading">
    <div class="shell">
        <div class="section-heading reveal">
            <div>
                <p class="eyebrow"><i class="fa-solid fa-star" aria-hidden="true"></i> Why builders trust us</p>
                <h2 id="experience-heading">Why choose this platform</h2>
            </div>
        </div>
        <div class="why-grid" role="list">
            <article class="why-card reveal" role="listitem">
                <i class="fa-solid fa-ruler-triangle" aria-hidden="true"></i>
                <h3>Professional documentation</h3>
                <p>Complete drawing sets with sections, schedules, and clear construction notes.</p>
            </article>
            <article class="why-card reveal" role="listitem">
                <i class="fa-solid fa-boxes-stacked" aria-hidden="true"></i>
                <h3>Flexible deliverables</h3>
                <p>Start free, then upgrade to Pro or Ultimate for CAD/BIM layers.</p>
            </article>
            <article class="why-card reveal" role="listitem">
                <i class="fa-solid fa-handshake" aria-hidden="true"></i>
                <h3>Guided decisions</h3>
                <p>Architect input on code compliance, climate adaptation, and structure.</p>
            </article>
            <article class="why-card reveal" role="listitem">
                <i class="fa-solid fa-wand-magic-sparkles" aria-hidden="true"></i>
                <h3>Curated aesthetics</h3>
                <p>Balanced proportions and modern layouts for premium builds.</p>
            </article>
            <article class="why-card reveal" role="listitem">
                <i class="fa-solid fa-clock" aria-hidden="true"></i>
                <h3>Faster approvals</h3>
                <p>Clear specs reduce revisions and help move to permits quickly.</p>
            </article>
            <article class="why-card reveal" role="listitem">
                <i class="fa-solid fa-shield-heart" aria-hidden="true"></i>
                <h3>Reliable support</h3>
                <p>Responsive assistance for modifications and build planning.</p>
            </article>
        </div>
    </div>
</section>

<section class="section section--use-cases" aria-labelledby="use-cases-heading">
    <div class="shell">
        <div class="section-heading reveal">
            <div>
                <p class="eyebrow"><i class="fa-solid fa-users" aria-hidden="true"></i> Use cases</p>
                <h2 id="use-cases-heading">Built for every kind of project team</h2>
                <p>Clear paths for homeowners, developers, and professional builders to act fast.</p>
            </div>
        </div>
        <div class="use-case-grid">
            <article class="use-case-card reveal">
                <h3>Homeowners</h3>
                <p>Choose plans with confidence, understand dimensions, and visualize outcomes.</p>
                <span>Best for first-time builders</span>
            </article>
            <article class="use-case-card reveal">
                <h3>Architects & designers</h3>
                <p>Extend CAD layers, customize details, and align with local requirements.</p>
                <span>Ideal for customization</span>
            </article>
            <article class="use-case-card reveal">
                <h3>Builders & contractors</h3>
                <p>Access construction-ready sets that shorten revisions and reduce delays.</p>
                <span>Built for execution</span>
            </article>
            <article class="use-case-card reveal">
                <h3>Developers</h3>
                <p>Scale reliable designs across multiple lots with consistent deliverables.</p>
                <span>Made for repeat builds</span>
            </article>
        </div>
    </div>
</section>

<section class="section section--proof" aria-labelledby="proof-heading">
    <div class="shell">
        <div class="section-heading reveal">
            <div>
                <p class="eyebrow"><i class="fa-solid fa-certificate" aria-hidden="true"></i> Social proof</p>
                <h2 id="proof-heading">A trusted studio for modern builds</h2>
                <p>Clear results, repeat clients, and predictable outcomes.</p>
            </div>
        </div>
        <div class="proof-grid" role="list">
            <div class="proof-card reveal" role="listitem">
                <strong>{{ stats.total_plans if stats else 120 }}+</strong>
                <p>Plans delivered with precision documentation</p>
            </div>
            <div class="proof-card reveal" role="listitem">
                <strong>{{ stats.total_orders if stats else 950 }}+</strong>
                <p>Successful purchases across our catalog</p>
            </div>
            <div class="proof-card reveal" role="listitem">
                <strong>4.9/5</strong>
                <p>Average client satisfaction on clarity & delivery</p>
            </div>
        </div>
        <div class="proof-testimonials">
            <figure class="testimonial-card reveal">
                <blockquote>“The documentation is impeccable. Our approvals were smooth and fast.”</blockquote>
                <figcaption>— Contracting lead, residential builds</figcaption>
            </figure>
            <figure class="testimonial-card reveal">
                <blockquote>“Professional layouts, easy to adjust, and impressive to clients.”</blockquote>
                <figcaption>— Architectural studio partner</figcaption>
            </figure>
        </div>
    </div>
</section>

<section class="section section--cta" aria-labelledby="cta-heading">
    <div class="shell section-cta glass">
        <div>
            <p class="eyebrow"><i class="fa-solid fa-lightbulb" aria-hidden="true"></i> Ready to build?</p>
            <h2 id="cta-heading">Start with a plan that feels built for you.</h2>
            <p>Explore premium layouts, secure clear deliverables, and get expert guidance when you need it.</p>
        </div>
        <div class="section-cta__actions">
            <a class="btn btn-primary btn--glow" href="{{ url_for('main.contact') }}"><i class="fa-solid fa-message" aria-hidden="true"></i> Start a conversation</a>
            <a class="btn btn-outline" href="{{ url_for('main.about') }}"><i class="fa-solid fa-users" aria-hidden="true"></i> Meet the team</a>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
    // Tailwind (homepage widget only): no preflight + prefixed classes to avoid collisions.
    window.tailwind = window.tailwind || {};
    window.tailwind.config = {
        prefix: 'tw-',
        corePlugins: { preflight: false },
    };
</script>
<script src="https://cdn.tailwindcss.com"></script>
<script>
    (function () {
        const previewUrl = "{{ url_for('floor_plan.api_preview') }}";
        const sessionizeUrl = "{{ url_for('floor_plan.api_sessionize') }}";
        const reportUrl = "{{ url_for('floor_plan.generate_report') }}";

        const unitEl = document.getElementById('fp-unit');
        const typeEl = document.getElementById('fp-room-type');
        const errorEl = document.getElementById('fp-error');
        const dimsWrap = document.getElementById('fp-dims');
        const surfaceWrap = document.getElementById('fp-surface');
        const lengthEl = document.getElementById('fp-length');
        const widthEl = document.getElementById('fp-width');
        const areaEl = document.getElementById('fp-area');
        const roomsEl = document.getElementById('fp-rooms');
        const addBtn = document.getElementById('fp-add');
        const analyzeBtn = document.getElementById('fp-analyze');
        const pdfBtn = document.getElementById('fp-pdf');
        const openBtn = document.getElementById('fp-open');

        const scoreEl = document.getElementById('fp-score');
        const wasteEl = document.getElementById('fp-waste');
        const finEl = document.getElementById('fp-fin');
        const comfEl = document.getElementById('fp-comf');
        const circEl = document.getElementById('fp-circ');
        const hintEl = document.getElementById('fp-dashboard-hint');

        if (!unitEl || !typeEl || !roomsEl || !addBtn || !analyzeBtn) return;

        const state = {
            unit_system: 'metric',
            rooms: [],
            lastPreview: null,
        };

        function getMethod() {
            const checked = document.querySelector('input[name="fp-method"]:checked');
            return checked ? checked.value : 'dimensions';
        }

        function setError(msg) {
            if (!errorEl) return;
            if (!msg) {
                errorEl.textContent = '';
                errorEl.classList.add('tw-hidden');
                return;
            }
            errorEl.textContent = msg;
            errorEl.classList.remove('tw-hidden');
        }

        function fmt(num) {
            if (num === null || num === undefined || Number.isNaN(num)) return '—';
            try {
                return Number(num).toFixed(0);
            } catch {
                return '—';
            }
        }

        function fmtPct(num) {
            if (num === null || num === undefined || Number.isNaN(num)) return '—';
            return Number(num).toFixed(1) + '%';
        }

        function unitLabel() {
            return state.unit_system === 'metric' ? 'm' : 'ft';
        }

        function areaUnitLabel() {
            return state.unit_system === 'metric' ? 'm²' : 'ft²';
        }

        function renderRooms() {
            roomsEl.innerHTML = '';
            state.rooms.forEach((r, idx) => {
                const card = document.createElement('div');
                card.className = 'tw-flex tw-items-start tw-justify-between tw-gap-3 tw-rounded-xl tw-border tw-border-slate-800 tw-bg-slate-900/40 tw-p-3';

                const left = document.createElement('div');
                left.className = 'tw-min-w-0';

                const title = document.createElement('p');
                title.className = 'tw-text-sm tw-font-semibold tw-text-white tw-truncate';
                title.textContent = r.type;
                left.appendChild(title);

                const meta = document.createElement('p');
                meta.className = 'tw-mt-1 tw-text-xs tw-text-slate-300';
                if (r.input_method === 'surface') {
                    meta.textContent = `Surface: ${r.surface} ${areaUnitLabel()}`;
                } else {
                    meta.textContent = `Dims: ${r.length} × ${r.width} ${unitLabel()}`;
                }
                left.appendChild(meta);

                const right = document.createElement('button');
                right.type = 'button';
                right.className = 'btn btn-outline btn-ghost';
                right.innerHTML = '<i class="fa-solid fa-trash" aria-hidden="true"></i>';
                right.addEventListener('click', () => {
                    state.rooms.splice(idx, 1);
                    state.lastPreview = null;
                    renderRooms();
                    refreshActions();
                    resetDashboard();
                });

                card.appendChild(left);
                card.appendChild(right);
                roomsEl.appendChild(card);
            });
        }

        function refreshActions() {
            const ok = state.rooms.length >= 3;
            analyzeBtn.disabled = !ok;
            pdfBtn.disabled = !ok;
            openBtn.disabled = !ok;
        }

        function resetDashboard() {
            if (!scoreEl || !wasteEl || !finEl || !comfEl || !circEl || !hintEl) return;
            scoreEl.textContent = '—';
            wasteEl.textContent = '—';
            finEl.textContent = '—';
            comfEl.textContent = '—';
            circEl.textContent = '—';
            hintEl.textContent = 'Tip: Add 3+ rooms and click Analyze.';
        }

        function toggleMethodUI() {
            const method = getMethod();
            setError('');
            if (method === 'surface') {
                dimsWrap.classList.add('tw-hidden');
                surfaceWrap.classList.remove('tw-hidden');
            } else {
                surfaceWrap.classList.add('tw-hidden');
                dimsWrap.classList.remove('tw-hidden');
            }
        }

        async function preview() {
            setError('');
            if (hintEl) hintEl.textContent = 'Analyzing…';

            const resp = await fetch(previewUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ unit_system: state.unit_system, rooms: state.rooms }),
            });

            const data = await resp.json().catch(() => null);
            if (!resp.ok || !data || !data.success) {
                throw new Error((data && data.error) || 'Preview failed');
            }

            state.lastPreview = data;
            const scores = data.scores || {};
            const summary = data.summary || {};
            if (scoreEl) scoreEl.textContent = fmt(scores.overall);
            if (wasteEl) wasteEl.textContent = fmtPct(summary.waste_percentage);
            if (finEl) finEl.textContent = fmt(scores.financial_efficiency);
            if (comfEl) comfEl.textContent = fmt(scores.comfort_efficiency);
            if (circEl) circEl.textContent = fmt(scores.circulation_efficiency);
            if (hintEl) {
                hintEl.textContent = `Rooms: ${summary.total_rooms || state.rooms.length} · Area: ${Number(summary.total_area || 0).toFixed(1)} ${areaUnitLabel()}`;
            }
        }

        async function sessionize() {
            const resp = await fetch(sessionizeUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ unit_system: state.unit_system, rooms: state.rooms }),
            });
            const data = await resp.json().catch(() => null);
            if (!resp.ok || !data || !data.success) {
                throw new Error((data && data.error) || 'Failed to start analysis');
            }
            return data;
        }

        function postTo(url) {
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = url;
            document.body.appendChild(form);
            form.submit();
            form.remove();
        }

        document.querySelectorAll('input[name="fp-method"]').forEach((el) => {
            el.addEventListener('change', toggleMethodUI);
        });

        unitEl.addEventListener('change', () => {
            state.unit_system = unitEl.value;
            state.lastPreview = null;
            renderRooms();
            resetDashboard();
        });

        addBtn.addEventListener('click', () => {
            setError('');

            const type = typeEl.value;
            if (!type) {
                setError('Pick a room type first.');
                return;
            }

            const method = getMethod();
            if (method === 'surface') {
                const surface = Number(areaEl.value);
                if (!surface || surface <= 0) {
                    setError('Enter a valid surface area.');
                    return;
                }
                state.rooms.push({ type, input_method: 'surface', surface });
                areaEl.value = '';
            } else {
                const length = Number(lengthEl.value);
                const width = Number(widthEl.value);
                if (!length || !width || length <= 0 || width <= 0) {
                    setError('Enter valid length and width.');
                    return;
                }
                state.rooms.push({ type, input_method: 'dimensions', length, width });
                lengthEl.value = '';
                widthEl.value = '';
            }

            typeEl.selectedIndex = 0;
            state.lastPreview = null;
            renderRooms();
            refreshActions();
            resetDashboard();
        });

        analyzeBtn.addEventListener('click', async () => {
            try {
                if (state.rooms.length < 3) {
                    setError('Add at least 3 rooms.');
                    return;
                }
                await preview();
            } catch (e) {
                setError((e && e.message) ? e.message : 'Preview failed.');
                if (hintEl) hintEl.textContent = 'Tip: Add 3+ rooms and click Analyze.';
            }
        });

        if (openBtn) {
            openBtn.addEventListener('click', async () => {
                try {
                    const data = await sessionize();
                    window.location.href = data.redirect_url;
                } catch (e) {
                    setError((e && e.message) ? e.message : 'Failed to open dashboard.');
                }
            });
        }

        if (pdfBtn) {
            pdfBtn.addEventListener('click', async () => {
                try {
                    await sessionize();
                    postTo(reportUrl);
                } catch (e) {
                    setError((e && e.message) ? e.message : 'Failed to generate PDF.');
                }
            });
        }

        // Initial state
        state.unit_system = unitEl.value;
        toggleMethodUI();
        refreshActions();
        resetDashboard();
    })();
</script>
<script>
    (function(){
        const input = document.getElementById('globalSearchInput');
        const panel = document.getElementById('globalSearchResults');
        if(!input || !panel) return;

        const root = input.closest('.hero__search') || panel.parentElement;

        const groupEls = {
            tools: panel.querySelector('[data-group="tools"]'),
            articles: panel.querySelector('[data-group="articles"]'),
            pages: panel.querySelector('[data-group="pages"]'),
        };

        const lists = {
            tools: panel.querySelector('[data-group="tools"] .search-results__list'),
            articles: panel.querySelector('[data-group="articles"] .search-results__list'),
            pages: panel.querySelector('[data-group="pages"] .search-results__list'),
        };
        const emptyState = panel.querySelector('.search-results__empty');

        let timer;
        let controller;

        function setExpanded(isExpanded){
            try{ input.setAttribute('aria-expanded', isExpanded ? 'true' : 'false'); }catch(e){}
        }

        function showPanel(){
            panel.hidden = false;
            setExpanded(true);
        }

        function hidePanel(){
            panel.hidden = true;
            setExpanded(false);
        }

        function clearGroups(){
            Object.values(lists).forEach(list => list && (list.innerHTML = ''));
        }

        function setEmptyMessage(message){
            if(!emptyState) return;
            emptyState.textContent = message;
            emptyState.hidden = false;
        }

        function hideEmptyMessage(){
            if(emptyState) emptyState.hidden = true;
        }

        function renderGroup(items, target){
            if(!target) return 0;
            if(!items || items.length === 0) return 0;
            target.innerHTML = items.map(item => {
                const summary = item.summary ? `<p>${item.summary}</p>` : '';
                return `<a class="search-results__item" href="${item.url}"><strong>${item.title}</strong>${summary}</a>`;
            }).join('');
            return items.length;
        }

        async function runSearch(){
            const q = (input.value || '').trim();
            if(!q){
                hidePanel();
                clearGroups();
                Object.values(groupEls).forEach(el => el && (el.hidden = false));
                if(emptyState) emptyState.hidden = true;
                return;
            }

            showPanel();
            setEmptyMessage('Searching…');

            clearGroups();
            Object.values(groupEls).forEach(el => el && (el.hidden = true));

            if(controller){
                try{ controller.abort(); }catch(e){}
            }
            controller = new AbortController();

            try{
                const resp = await fetch(`/search?q=${encodeURIComponent(q)}`, { signal: controller.signal });
                const data = await resp.json();
                clearGroups();
                const toolsCount = renderGroup(data.results.tools, lists.tools);
                const articlesCount = renderGroup(data.results.articles, lists.articles);
                const pagesCount = renderGroup(data.results.pages, lists.pages);
                const total = toolsCount + articlesCount + pagesCount;

                if(groupEls.tools) groupEls.tools.hidden = toolsCount === 0;
                if(groupEls.articles) groupEls.articles.hidden = articlesCount === 0;
                if(groupEls.pages) groupEls.pages.hidden = pagesCount === 0;

                if(total > 0){
                    hideEmptyMessage();
                }else{
                    setEmptyMessage('No matches yet. Try a room name, a planner, or a comfort topic.');
                }

                showPanel();
            }catch(e){
                if(e && e.name === 'AbortError') return;
                Object.values(groupEls).forEach(el => el && (el.hidden = true));
                setEmptyMessage('We could not search right now. Please try again.');
                showPanel();
            }
        }

        function debounceSearch(){
            clearTimeout(timer);
            timer = setTimeout(runSearch, 220);
        }

        input.addEventListener('input', debounceSearch);
        input.addEventListener('focus', function(){
            if((input.value || '').trim()) debounceSearch();
        });

        input.addEventListener('keydown', function(e){
            if(e.key === 'Escape'){
                hidePanel();
                input.blur();
            }
        });

        input.addEventListener('blur', function(){
            window.setTimeout(function(){
                if(!root) return;
                if(root.contains(document.activeElement)) return;
                hidePanel();
            }, 120);
        });

        document.addEventListener('click', function(e){
            if(!root) return;
            if(root.contains(e.target)) return;
            hidePanel();
        });
    })();
</script>
<script>
    (function () {
        const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
        const elements = document.querySelectorAll('.reveal');

        if (!elements.length) return;

        if (prefersReduced) {
            elements.forEach(el => el.classList.add('is-visible'));
            return;
        }

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('is-visible');
                    observer.unobserve(entry.target);
                }
            });
        }, { threshold: 0.2, rootMargin: '0px 0px -10% 0px' });

        elements.forEach(el => observer.observe(el));
    })();
</script>
{% endblock %}
