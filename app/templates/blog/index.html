{% extends "base.html" %}

{% block title %}Blog{% endblock %}

{% block content %}
<section class="section blog-hero" aria-labelledby="blog-hero-heading">
    <div class="shell">
        <div class="section-heading">
            <div>
                <p class="eyebrow"><i class="fa-solid fa-pen-nib" aria-hidden="true"></i> Editorial</p>
                <h1 id="blog-hero-heading">Architecture insights & build guides</h1>
                <p>Learn how to choose, customize, and execute premium house plans with confidence.</p>
            </div>
        </div>
        <form class="blog-filters" method="get" action="{{ url_for('blog.index') }}" aria-label="Blog filters">
            <label class="form-group">
                <span class="form-label">Search</span>
                <input class="form-input" type="search" name="q" placeholder="Search articles" value="{{ query }}">
            </label>
            <label class="form-group">
                <span class="form-label">Category</span>
                <select class="form-select" name="category">
                    <option value="">All categories</option>
                    {% for c in categories %}
                        <option value="{{ c.slug }}" {% if c.slug == category %}selected{% endif %}>{{ c.name }}</option>
                    {% endfor %}
                </select>
            </label>
            <div class="blog-filters__actions">
                <button class="btn btn-primary" type="submit"><i class="fa-solid fa-magnifying-glass" aria-hidden="true"></i> Search</button>
                <a class="btn btn-ghost" href="{{ url_for('blog.index') }}">Reset</a>
            </div>
        </form>
    </div>
</section>

<section class="section blog-list" aria-label="Blog posts">
    <div class="shell">
        <div class="blog-grid">
            {% for post in posts %}
            <article class="blog-card" itemscope itemtype="https://schema.org/Article">
                <a class="blog-card__media" href="{{ url_for('blog.detail', slug=post.slug) }}" itemprop="url">
                    {% set cover = upload_url(post.cover_image) if post.cover_image else url_for('static', filename='images/placeholder.svg') %}
                    <img src="{{ cover }}" alt="{{ post.title }}" loading="lazy" decoding="async" itemprop="image">
                </a>
                <div class="blog-card__body">
                    <p class="blog-card__meta">{{ post.created_at.strftime('%b %d, %Y') }}</p>
                    <h2 class="blog-card__title" itemprop="headline">
                        <a href="{{ url_for('blog.detail', slug=post.slug) }}">{{ post.title }}</a>
                    </h2>
                    <p class="blog-card__summary" itemprop="description">{{ post.meta_description or post.title }}</p>
                    <div class="blog-card__footer">
                        <a class="text-link" href="{{ url_for('blog.detail', slug=post.slug) }}">Read article</a>
                        {% if post.linked_plan %}
                            <span class="badge badge--outline">Linked plan</span>
                        {% endif %}
                    </div>
                </div>
            </article>
            {% else %}
            <div class="blog-empty">
                <p>No blog posts found.</p>
            </div>
            {% endfor %}
        </div>

        {% if pagination and pagination.pages > 1 %}
            {% set endpoint = 'blog.index' %}
            {% include "_pagination.html" %}
        {% endif %}
    </div>
</section>
{% endblock %}
