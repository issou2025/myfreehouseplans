{% extends 'base.html' %}

{% block title %}Home Space Decision Assistant | {{ site_name }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/area_calculator.css') }}">
{% endblock %}

{% block structured_data %}
  {% if result and result.faq %}
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "FAQPage",
        "mainEntity": [
          {% for item in result.faq %}
          {
            "@type": "Question",
            "name": {{ item.question|tojson }},
            "acceptedAnswer": {
              "@type": "Answer",
              "text": {{ item.answer|tojson }}
            }
          }{% if not loop.last %},{% endif %}
          {% endfor %}
        ]
      }
    </script>
  {% endif %}
{% endblock %}

{% block content %}
<section class="shell area-hero">
  <div class="area-hero__content">
    <p class="eyebrow">International planning tool</p>
    <h1>Home Space Decision Assistant</h1>
    <p class="lead">
      Make confident decisions about your future home. We translate household needs into a clear room program, gross area,
      and land fit so you can avoid overbuilding, under‑sizing, or wasting land.
    </p>
    <p class="note">Also known as Smart Home Space Planner • House Size Decision Tool • Living Space Advisor</p>
  </div>
</section>

<section class="shell area-section" aria-label="How this calculator works">
  <h2>How the calculator works (international, not country‑specific)</h2>
  <p>
    The goal of this calculator is simple: transform “How big should our house be?” into a clear, defensible program
    of rooms and areas. It does not rely on any local building code. Instead, it uses globally used architectural
    planning benchmarks: sleeping zones scale with occupants, living zones grow with household activity, and circulation
    space expands as the number of rooms increases. The result is a balanced net area, then a gross area that adds
    realistic allowance for walls, storage shafts, and technical thickness.
  </p>
  <p>
    You start by describing your household in human terms. We ask how many people will live in the home, the household
    type (single, couple, family, extended family), your comfort level, and whether you expect future growth. Optional
    inputs such as land size and extra rooms help the calculator validate the footprint and recommend a more suitable
    layout, including the option of a two‑storey plan when land becomes tight.
  </p>
  <p>
    Every output is expressed in plain language. Tables break down bedroom counts, living spaces, optional rooms,
    sanitary spaces, and circulation. This prevents guesswork and lets you compare plans with confidence. The entire
    page is server‑rendered so search engines can fully index the explanations and tables. The result is a high‑clarity
    tool for planning, budgeting, and long‑term comfort.
  </p>
</section>

<section class="shell area-section" aria-label="Home space decision assistant tool">
  <h2>Use the Home Space Decision Assistant</h2>
  <div class="area-grid">
    <div class="area-card">
      <h3>Tell us about your household</h3>
      <form method="post" class="area-form" novalidate>
        <div class="area-field">
          <label for="occupants">Number of people living in the house</label>
          <input id="occupants" name="occupants" type="number" min="1" max="10" value="{{ form.occupants }}" required>
        </div>

        <div class="area-field">
          <label for="household_type">Household type</label>
          <select id="household_type" name="household_type">
            <option value="single" {% if form.household_type == 'single' %}selected{% endif %}>Single</option>
            <option value="couple" {% if form.household_type == 'couple' %}selected{% endif %}>Couple</option>
            <option value="family" {% if form.household_type == 'family' %}selected{% endif %}>Family</option>
            <option value="extended_family" {% if form.household_type == 'extended_family' %}selected{% endif %}>Extended family</option>
          </select>
        </div>

        <div class="area-field">
          <label for="comfort_level">Comfort level</label>
          <select id="comfort_level" name="comfort_level">
            <option value="essential" {% if form.comfort_level == 'essential' %}selected{% endif %}>Essential</option>
            <option value="standard" {% if form.comfort_level == 'standard' %}selected{% endif %}>Standard</option>
            <option value="high" {% if form.comfort_level == 'high' %}selected{% endif %}>High</option>
          </select>
        </div>

        <div class="area-field">
          <label for="future_growth">Future household growth</label>
          <select id="future_growth" name="future_growth">
            <option value="no" {% if form.future_growth == 'no' %}selected{% endif %}>No</option>
            <option value="maybe" {% if form.future_growth == 'maybe' %}selected{% endif %}>Maybe</option>
            <option value="yes" {% if form.future_growth == 'yes' %}selected{% endif %}>Yes</option>
          </select>
        </div>

        <fieldset class="area-fieldset">
          <legend>Extra rooms (optional)</legend>
          <label class="check">
            <input type="checkbox" name="extra_rooms" value="home_office" {% if 'home_office' in form.extra_rooms %}checked{% endif %}>
            <span>Home office</span>
          </label>
          <label class="check">
            <input type="checkbox" name="extra_rooms" value="guest_room" {% if 'guest_room' in form.extra_rooms %}checked{% endif %}>
            <span>Guest room</span>
          </label>
          <label class="check">
            <input type="checkbox" name="extra_rooms" value="storage" {% if 'storage' in form.extra_rooms %}checked{% endif %}>
            <span>Storage</span>
          </label>
        </fieldset>

        <div class="area-field">
          <label>Preferred unit</label>
          <div class="unit-toggle">
            <label class="unit-toggle__option">
              <input type="radio" name="unit" value="m2" {% if unit == 'm2' %}checked{% endif %}>
              <span>m² (square meters)</span>
            </label>
            <label class="unit-toggle__option">
              <input type="radio" name="unit" value="ft2" {% if unit == 'ft2' %}checked{% endif %}>
              <span>ft² (square feet)</span>
            </label>
          </div>
        </div>

        <div class="area-field">
          <label for="land_size">Land size ({{ unit_label }}) — optional</label>
          <input id="land_size" name="land_size" type="number" min="1" value="{{ form.land_size }}" placeholder="e.g., 350">
        </div>

        <div class="area-field">
          <label for="layout">Preferred layout</label>
          <select id="layout" name="layout">
            <option value="no_preference" {% if form.layout == 'no_preference' %}selected{% endif %}>No preference</option>
            <option value="single_storey" {% if form.layout == 'single_storey' %}selected{% endif %}>Single-storey</option>
            <option value="two_storey" {% if form.layout == 'two_storey' %}selected{% endif %}>Two-storey</option>
          </select>
        </div>

        <div class="area-actions">
          <button class="btn btn-primary" type="submit">Calculate area</button>
          <a class="btn btn-secondary" href="{{ url_for('area_calculator.index') }}">Reset</a>
        </div>
      </form>
    </div>

    <div class="area-card area-card--summary">
      <h3>What you will get</h3>
      <ul>
        <li>Bedroom count and sizing by occupants</li>
        <li>Living, kitchen, dining, and day‑space estimates</li>
        <li>Sanitary program (bathrooms + WC)</li>
        <li>Circulation allowance based on rooms + people</li>
        <li>Net and gross area totals with explanations</li>
        <li>Land compatibility check when land size is provided</li>
      </ul>
      <p class="note">
        This is a planning and sizing tool. It is not a local regulation, permit, or budget approval. Use it to align your
        program, then validate with a professional for your location.
      </p>
    </div>
  </div>
</section>

{% if article_context %}
  <section class="shell area-section" aria-label="Context from article">
    <div class="area-card area-card--context">
      <p class="eyebrow">From the article</p>
      <h2>{{ article_context.title or 'Use this calculator with confidence' }}</h2>
      <p class="lead">{{ article_context.body or 'This calculator turns the article guidance into a clear room-by-room program.' }}</p>
      <div class="area-actions">
        <a class="btn btn-secondary" href="{{ url_for('blog.detail', slug=article_context.post.slug) }}">Back to the article</a>
      </div>
    </div>
  </section>
{% endif %}

<section class="shell area-section" aria-label="Results overview">
  <h2>Results overview</h2>
  <p>
    Start with the high-level numbers first. These summarize the size, room count, and circulation allowance so you can
    decide if the program feels compact, balanced, or spacious before diving into the detailed tables.
  </p>

  {% if result %}
    <div class="area-summary-grid">
      {% for card in summary_cards %}
        <div class="area-card area-card--metric">
          <div class="area-metric__label">{{ card.label }}</div>
          <div class="area-metric__value">{{ card.value }}</div>
          <div class="area-metric__helper">{{ card.helper }}</div>
        </div>
      {% endfor %}
    </div>
    {% if pdf_url %}
      <div class="area-download">
        <a class="btn btn-primary" href="{{ pdf_url }}">Download PDF</a>
        <p class="note">Your report uses {{ unit_label }} ({{ unit_name }}) and includes all tables below.</p>
      </div>
    {% endif %}
  {% else %}
    <p class="note">Complete the form to generate your results summary.</p>
  {% endif %}
</section>

<section class="shell area-section" aria-label="What this means for you">
  <h2>What this means for you</h2>
  <p>These notes interpret the results in everyday language so you can plan with confidence.</p>

  {% if result %}
    <div class="area-callouts">
      {% for insight in result.insights %}
        <div class="area-callout area-callout--{{ insight.tone }}">
          <h3>{{ insight.title }}</h3>
          <p>{{ insight.body }}</p>
        </div>
      {% endfor %}
      {% for warning in result.warnings %}
        <div class="area-callout area-callout--{{ warning.tone }}">
          <h3>{{ warning.title }}</h3>
          <p>{{ warning.body }}</p>
        </div>
      {% endfor %}
      {% for tradeoff in result.tradeoffs %}
        <div class="area-callout area-callout--{{ tradeoff.tone }}">
          <h3>{{ tradeoff.title }}</h3>
          <p>{{ tradeoff.body }}</p>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <p class="note">Submit the form to receive human-readable guidance.</p>
  {% endif %}
</section>

<section class="shell area-section" aria-label="Alternative sizing options">
  <h2>Alternative sizing options</h2>
  <p>Use these as a quick decision set if you want to adjust comfort or footprint without changing the room count.</p>

  {% if result and result.alternatives %}
    <div class="area-alternatives">
      {% for option in result.alternatives %}
        <div class="area-card area-card--option">
          <h3>{{ option.label }}</h3>
          <p class="note">{{ option.description }}</p>
          <div class="area-option-grid">
            <div><span class="area-option__label">Gross area</span><strong>{{ format_area(option.gross_area) }}</strong></div>
            <div><span class="area-option__label">Net area</span><strong>{{ format_area(option.net_area) }}</strong></div>
            <div><span class="area-option__label">Bedrooms</span><strong>{{ option.bedrooms }}</strong></div>
            <div><span class="area-option__label">Bathrooms</span><strong>{{ option.bathrooms }}</strong></div>
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <p class="note">Alternatives appear after your first calculation.</p>
  {% endif %}
</section>

<section class="shell area-section" aria-label="Detailed breakdown">
  <h2>Detailed breakdown</h2>
  <p>
    The tables below show the full room program. Each table is labeled so it stays readable on mobile without
    horizontal scrolling.
  </p>

  <div class="area-results">
    <details class="area-detail" {% if result %}open{% endif %}>
      <summary>User inputs summary</summary>
      <div class="area-table">
        <table>
          <caption>Your inputs, shown exactly as entered.</caption>
          <thead>
            <tr>
              <th>Parameter</th>
              <th>Value</th>
            </tr>
          </thead>
          <tbody>
            {% if result %}
              {% for row in input_summary %}
                <tr>
                  <td data-label="Parameter">{{ row.label }}</td>
                  <td data-label="Value">{{ row.value }}</td>
                </tr>
              {% endfor %}
            {% else %}
              <tr>
                <td colspan="2">Submit the form to summarize your inputs.</td>
              </tr>
            {% endif %}
          </tbody>
        </table>
      </div>
    </details>

    <details class="area-detail" {% if result %}open{% endif %}>
      <summary>Bedrooms</summary>
      <div class="area-table">
        <table>
          <caption>Bedroom sizing based on occupants and comfort level.</caption>
          <thead>
            <tr>
              <th>Room Type</th>
              <th>Quantity</th>
              <th>Area per Room ({{ unit_label }})</th>
              <th>Total Area ({{ unit_label }})</th>
            </tr>
          </thead>
          <tbody>
            {% if result %}
              {% for row in result.bedrooms %}
                <tr>
                  <td data-label="Room Type">{{ row.label }}</td>
                  <td data-label="Quantity">{{ row.quantity }}</td>
                  <td data-label="Area per Room">{{ format_area_value(row.area_each) }}</td>
                  <td data-label="Total Area">{{ format_area_value(row.total_area) }}</td>
                </tr>
              {% endfor %}
            {% else %}
              <tr>
                <td colspan="4">Complete the form to calculate bedroom sizes.</td>
              </tr>
            {% endif %}
          </tbody>
        </table>
      </div>
    </details>

    <details class="area-detail" {% if result %}open{% endif %}>
      <summary>Living and day spaces</summary>
      <div class="area-table">
        <table>
          <caption>Living, kitchen, and dining areas scaled by household size.</caption>
          <thead>
            <tr>
              <th>Space</th>
              <th>Quantity</th>
              <th>Area ({{ unit_label }})</th>
            </tr>
          </thead>
          <tbody>
            {% if result %}
              {% for row in result.living_day %}
                <tr>
                  <td data-label="Space">{{ row.label }}</td>
                  <td data-label="Quantity">{{ row.quantity }}</td>
                  <td data-label="Area">{{ format_area_value(row.total_area) }}</td>
                </tr>
              {% endfor %}
            {% else %}
              <tr>
                <td colspan="3">Complete the form to calculate day-space areas.</td>
              </tr>
            {% endif %}
          </tbody>
        </table>
      </div>
    </details>

    <details class="area-detail">
      <summary>Additional rooms</summary>
      <div class="area-table">
        <table>
          <caption>Optional rooms and flex space chosen in the form.</caption>
          <thead>
            <tr>
              <th>Space</th>
              <th>Quantity</th>
              <th>Area ({{ unit_label }})</th>
            </tr>
          </thead>
          <tbody>
            {% if result and result.additional %}
              {% for row in result.additional %}
                <tr>
                  <td data-label="Space">{{ row.label }}</td>
                  <td data-label="Quantity">{{ row.quantity }}</td>
                  <td data-label="Area">{{ format_area_value(row.total_area) }}</td>
                </tr>
              {% endfor %}
            {% else %}
              <tr>
                <td colspan="3">Optional rooms will appear here.</td>
              </tr>
            {% endif %}
          </tbody>
        </table>
      </div>
    </details>

    <details class="area-detail">
      <summary>Sanitary spaces</summary>
      <div class="area-table">
        <table>
          <caption>Bathroom and WC sizing for daily routines.</caption>
          <thead>
            <tr>
              <th>Space</th>
              <th>Quantity</th>
              <th>Area per Unit ({{ unit_label }})</th>
              <th>Total Area ({{ unit_label }})</th>
            </tr>
          </thead>
          <tbody>
            {% if result %}
              {% for row in result.sanitary %}
                <tr>
                  <td data-label="Space">{{ row.label }}</td>
                  <td data-label="Quantity">{{ row.quantity }}</td>
                  <td data-label="Area per Unit">{{ format_area_value(row.area_each) }}</td>
                  <td data-label="Total Area">{{ format_area_value(row.total_area) }}</td>
                </tr>
              {% endfor %}
            {% else %}
              <tr>
                <td colspan="4">Sanitary sizing will appear here.</td>
              </tr>
            {% endif %}
          </tbody>
        </table>
      </div>
    </details>

    <details class="area-detail">
      <summary>Circulation</summary>
      <div class="area-table">
        <table>
          <caption>Movement and transition space based on rooms and occupants.</caption>
          <thead>
            <tr>
              <th>Element</th>
              <th>Calculation Method</th>
              <th>Area ({{ unit_label }})</th>
            </tr>
          </thead>
          <tbody>
            {% if result %}
              {% for row in result.circulation %}
                <tr>
                  <td data-label="Element">{{ row.label }}</td>
                  <td data-label="Method">{{ row.method }}</td>
                  <td data-label="Area">{{ format_area_value(row.area) }}</td>
                </tr>
              {% endfor %}
            {% else %}
              <tr>
                <td colspan="3">Circulation results will appear here.</td>
              </tr>
            {% endif %}
          </tbody>
        </table>
      </div>
    </details>

    <details class="area-detail" {% if result %}open{% endif %}>
      <summary>Total areas</summary>
      <div class="area-table">
        <table>
          <caption>Net, circulation, and gross area totals.</caption>
          <thead>
            <tr>
              <th>Category</th>
              <th>Area ({{ unit_label }})</th>
            </tr>
          </thead>
          <tbody>
            {% if result %}
              {% for row in result.totals %}
                <tr class="area-row--total">
                  <td data-label="Category">{{ row.label }}</td>
                  <td data-label="Area">{{ format_area_value(row.area) }}</td>
                </tr>
              {% endfor %}
            {% else %}
              <tr>
                <td colspan="2">Total areas will appear here.</td>
              </tr>
            {% endif %}
          </tbody>
        </table>
      </div>
    </details>

    <details class="area-detail">
      <summary>Land compatibility</summary>
      <div class="area-table">
        <table>
          <caption>Footprint and site coverage insights based on your land size.</caption>
          <thead>
            <tr>
              <th>Parameter</th>
              <th>Value</th>
            </tr>
          </thead>
          <tbody>
            {% if result %}
              {% for row in land_rows %}
                <tr>
                  <td data-label="Parameter">{{ row.label }}</td>
                  <td data-label="Value">{{ row.value }}</td>
                </tr>
              {% endfor %}
            {% else %}
              <tr>
                <td colspan="2">Provide land size to evaluate footprint compatibility.</td>
              </tr>
            {% endif %}
          </tbody>
        </table>
      </div>
    </details>
  </div>
</section>

<section class="shell area-section" aria-label="Recommendations">
  <h2>Recommendations & next steps</h2>
  <p>
    The calculator translates raw numbers into clear recommendations. Use these to decide whether you should shift to a
    two‑storey option, add a bedroom for privacy, or focus on saving land for outdoor comfort. These recommendations are
    intentionally general and internationally applicable.
  </p>

  <div class="area-recommendations">
    {% if result %}
      <div class="area-callouts">
        {% for rec in result.recommendations %}
          <div class="area-callout area-callout--{{ rec.tone }}">
            <h3>{{ rec.title }}</h3>
            <p>{{ rec.detail }}</p>
          </div>
        {% endfor %}
      </div>

      <div class="area-next-steps">
        <h3>Next steps</h3>
        <ul>
          {% for step in next_steps_display %}
            <li>{{ step }}</li>
          {% endfor %}
        </ul>
      </div>
    {% else %}
      <p class="note">Submit the form to receive personalized recommendations.</p>
    {% endif %}
  </div>
</section>

<section class="shell area-section" aria-label="Frequently asked questions">
  <h2>FAQ for your results</h2>
  <p>Short answers to the most common questions about the numbers above.</p>

  {% if result and result.faq %}
    <div class="area-faq">
      {% for item in result.faq %}
        <details class="area-faq__item">
          <summary>{{ item.question }}</summary>
          <p>{{ item.answer }}</p>
        </details>
      {% endfor %}
    </div>
  {% else %}
    <p class="note">Run the calculator to see FAQ answers tailored to your result.</p>
  {% endif %}
</section>

<section class="shell area-section" aria-label="Related resources">
  <h2>Related plans and educational resources</h2>
  <p>
    Planning works best when you can immediately compare real plans that match your size program. Below are a few
    relevant plans and educational articles to keep your decision grounded in real examples.
  </p>

  <div class="area-links">
    <div>
      <h3>Recommended house plans</h3>
      <ul class="area-links__list">
        {% for plan in recommended_plans %}
          <li>
            <a href="{{ url_for('main.pack_detail', slug=plan.slug) }}">{{ plan.title }}</a>
            {% if plan.short_description %}<span class="muted">— {{ plan.short_description }}</span>{% endif %}
          </li>
        {% else %}
          <li>No plans available yet.</li>
        {% endfor %}
      </ul>
    </div>
    <div>
      <h3>Educational articles</h3>
      <ul class="area-links__list">
        {% for item in recommended_articles %}
          <li>
            <a href="{{ url_for('blog.detail', slug=item.post.slug) }}">{{ item.title }}</a>
            {% if item.body %}<span class="muted">— {{ item.body }}</span>{% endif %}
          </li>
        {% else %}
          <li>New articles are coming soon.</li>
        {% endfor %}
      </ul>
      <p class="note">You can also explore the <a href="{{ url_for('space_planner.index') }}">Space Planner tools</a> for room‑level checks.</p>
    </div>
  </div>
</section>

{% if result and pdf_url %}
  <div class="area-sticky-spacer" aria-hidden="true"></div>
  <div class="area-sticky" aria-label="Download PDF">
    <a class="btn btn-primary" href="{{ pdf_url }}">Download PDF</a>
  </div>
{% endif %}

<section class="shell area-section" aria-label="Why these rules are trustworthy">
  <h2>Why these rules are trustworthy</h2>
  <p>
    The sizing logic uses global residential planning norms: a minimum master bedroom that scales with household size,
    secondary bedrooms sized to allow sleeping and circulation, living spaces that expand with social activity, and a
    circulation ratio that grows as the plan becomes more complex. These are not legal limits; they are the practical
    ranges used by architects to reduce daily friction. Because the same family behavior appears worldwide, these rules
    travel well across climates and budgets.
  </p>
  <p>
    This is why the calculator never returns a single "magic" number. Instead, it explains how each area was derived and
    keeps every decision visible. That transparency is what turns a simple calculator into a planning tool you can trust.
  </p>
</section>

<script>
  (() => {
    const form = document.querySelector('.area-form');
    const unitInputs = document.querySelectorAll('input[name="unit"]');
    if (!form || unitInputs.length === 0) return;
    unitInputs.forEach((input) => {
      input.addEventListener('change', () => {
        if (typeof form.requestSubmit === 'function') {
          form.requestSubmit();
        } else {
          form.submit();
        }
      });
    });
  })();
</script>
{% endblock %}
