# Render deployment configuration for MyFreeHousePlans
services:
  # Web Service
  - type: web
    name: myfreehouseplans
    runtime: python
    env: python
    pythonVersion: 3.11.9
    region: oregon
    plan: free
    branch: main
    autodeploy: true
    healthCheckPath: /health
    buildCommand: apt-get update && apt-get install -y wkhtmltopdf && pip install -r requirements.txt
    releaseCommand: flask db upgrade && flask reset-admin-password --username ${ADMIN_USERNAME}
    startCommand: gunicorn wsgi:app --bind 0.0.0.0:$PORT --workers 4 --timeout 120 --log-level info
    envVars:
      - key: FLASK_APP
        value: wsgi:app
      - key: FLASK_ENV
        value: production
      - key: FLASK_CONFIG
        value: production
      - key: SECRET_KEY
        generateValue: true
      # SECURITY: Admin credentials must be set in Render Dashboard
      # DO NOT commit ADMIN_USERNAME, ADMIN_EMAIL, or ADMIN_PASSWORD to git
      # These are declared here to document required env vars but have no value
      - key: ADMIN_USERNAME
        sync: false  # Managed in Render Dashboard only
      - key: ADMIN_EMAIL
        sync: false  # Managed in Render Dashboard only
      - key: ADMIN_PASSWORD
        sync: false  # Managed in Render Dashboard only
      - key: PROTECTED_UPLOAD_FOLDER
        value: uploads_protected
      - key: UPLOAD_FOLDER
        value: app/static/uploads
      - key: DATABASE_URL
        fromDatabase:
          name: myfreehouseplan-db
          property: connectionString

databases:
  - name: myfreehouseplan-db
    region: oregon
    plan: free  # Change to starter or higher for production
    databaseName: myfreehouseplan
    databaseUser: myfreehouseplan_user
    ipAllowList: []  # Empty means allow all
